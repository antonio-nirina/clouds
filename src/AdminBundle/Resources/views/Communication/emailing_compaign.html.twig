{% extends "AdminBundle::layout.html.twig" %}

{% block header %}
    {% embed 'AdminBundle::header.html.twig' %}
        {% block stylesheets %}
            {{ parent() }}
            <link href="{{ asset("chosen/chosen.css") }}" rel="stylesheet">
            <link href="{{ asset("css/admin-parameters-registration.css") }}" rel="stylesheet">
            <link href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">
            <link href="{{ asset("minicolors/css/jquery.minicolors.css") }}" rel="stylesheet">
        {% endblock %}
    {% endembed %}
{% endblock %}

{% block main %}
    {{ render(controller('AdminBundle:Communication:sidebar',{'active':1})) }}

    <main class="col-md-9  offset-md-1 float-left main">

        <div class = "row">
            <div class = "col-12 col-md-12 sous-menu-main">
                <nav class="navbar navbar-toggleable-md navbar-inverse bg-inverse menu-niv-3">
                    <ul class="content-menu-niv-3 hidden-lg-up">
                        <li class="nav-item-niv-3 form-inscription">
                            <a class="nav-link-niv-3 menu-page-active" href="{{ path("admin_communication_emailing_compaign") }}">campagnes </a>
                            <span class = "bulle-aide"></span>
                        </li>
                    </ul>
                    <div class="navbar-collapse collapse" id="collapsingNavbarFormInscription">
                        <ul class="navbar-nav content-menu-niv-3">
                            <li class="nav-item-niv-3 form-inscription hidden-md-down">
                                <a class="nav-link-niv-3 menu-page-active" href="{{ path("admin_communication_emailing_compaign") }}">campagnes </a>
                                <span class = "bulle-aide"></span>
                            </li>
                            <li class="nav-item-niv-3 form-inscription">
                                <a class="nav-link-niv-3 menu-page" href="{{ path("admin_communication_emailing_templates") }}">templates </a>
                                <span class = "bulle-aide"></span>
                            </li>
                            <li class="nav-item-niv-3 form-inscription">
                                <a class="nav-link-niv-3 menu-page" href="#">liste de diffusion </a>
                                <span class = "bulle-aide"></span>
                            </li>
                            <li class="nav-item-niv-3 form-inscription">
                                <a class="nav-link-niv-3 menu-page" href="#">rapports </a>
                                <span class = "bulle-aide"></span>
                            </li>
                            <li class="nav-item-niv-3 form-inscription">
                                <a class="nav-link-niv-3 menu-page" href="#">sur-mesures </a>
                                <span class = "bulle-aide"></span>
                            </li>
                        </ul>
                    </div>
                    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#collapsingNavbarFormInscription" style = "margin-right: 0;right: 0;color: #505050;border: 1px solid black;">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <a class="navbar-brand abs" href="#"></a>
                </nav>
            </div>
        </div>

        <div class = "row">
            <div class = "col-12 col-md-12">
                <section class="fieldset slideshow active">
                    <div class="row filter">
                        <div class="create">
                            <button class="btn-valider" data-toggle="modal" data-target="#new-campaign-modal">
                                créer une campagne
                            </button>
                        </div>
                        <div class="next-create">                            
                            <div class="dropdown clearable filtres">
                                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuFiltre" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-default="FILTRES">
                                    FILTRES
                                </button>
                                <div class="dropdown-menu" aria-labelledby="dropdownMenuFiltre">
                                    <a class="dropdown-item" href="#">
                                        RÉCENTS
                                        <span>create_time</span>
                                    </a>
                                    <a class="dropdown-item" href="#">
                                        ENVOYÉS
                                        <span>send_time</span>
                                    </a>
                                    <a class="dropdown-item" href="#">
                                        EN COURS
                                        <span>send_time</span>
                                    </a>
                                    <a class="dropdown-item" href="#">
                                        EN ATTENTES
                                        <span>send_time</span>
                                    </a>
                                </div>
                                <span class="delete-input"></span>
                            </div>

                            <div>
                                <a href="#" class="add add-folder-link add-to-archive">
                                    archivées
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="row filter selected-campaign">
                        <div class="create campagne-count">
                            <div class="selected-count">
                                <input type="text" value="campagne sélectionnée">
                                <span class="delete-input"></span>
                            </div>
                        </div>
                        <div class="next-create campaign-delete-move">                            
                            <div class="campaign-archive">
                                <button class="btn-valider" class="btn btn-primary">
                                    archiver
                                </button> 
                            </div>
                            <div class="campaign-delete">
                                <button class="btn-valider" class="btn btn-primary" data-toggle="modal" data-target="#delete-modal-campaign">
                                    supprimer
                                </button> 
                            </div>
                        </div>
                    </div> 
                    <div class="row list">
                        {% for li in list %}
                            <div class="row campaign-{{li.id}}">
                                <div class="campagne-name">
                                    <input type="checkbox" class="styled-checkbox bigger" id="{{li.id}}">
                                    <label for="{{li.id}}">
                                        <span></span>
                                        <div class="campagne-name-name">
                                            {{ li.settings["title"] }}
                                        </div>
                                        <div class="campagne-name-date">
                                            {{ li.status }} - {{ li.createTime | localizeddate('none', 'none', locale, null, "'le' d MMMM Y 'à' H:mm") }}
                                        </div>
                                    </label>                           
                                </div>
                                <div class="campagne-metric">
                                    <div class="metric-1">
                                        <span class="metric-value">
                                            {{ (li.recipients["recipient_count"] is defined)?li.recipients["recipient_count"]:0 }}
                                        </span>
                                        <span class="metric-desc">inscrits</span>
                                    </div>
                                    <div class="metric-2">
                                        <span class="metric-value">
                                            {{ (li.reportSummary["open_rate"] is defined)?li.reportSummary["open_rate"]:0 }} %
                                        </span>
                                        <span class="metric-desc">ouvertures</span>
                                    </div>
                                    <div class="metric-3">
                                        <span class="metric-value">
                                            {{ (li.reportSummary["click_rate"] is defined)?li.reportSummary["click_rate"]:0}} %
                                        </span>
                                        <span class="metric-desc">clics</span>
                                    </div>
                                </div>
                                <div class="campagne-action">
                                    <div class="dropdown">
                                        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuAction" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-default="ACTIONS">
                                            ACTIONS
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="dropdownMenuAction">
                                            <a class="dropdown-item" href="#">STATISTIQUES</a>
                                            <a class="dropdown-item" href="#">APERÇU</a>
                                            <a class="dropdown-item campaign-replicate" href="#">DUPLIQUER</a>
                                            <a class="dropdown-item campaign-rename" href="#">ARCHIVER</a>                                     
                                            <input type="hidden" name="campaign-id" value="{{ li.id }}">                                           
                                        </div>
                                    </div>
                                </div>                            
                            </div>
                        {% endfor %}                    
                    </div>                    
                    <div class="row ending">
                        
                    </div>
                    {# modal rename #}
                    <button type="button" id="btn-modal-rename" class="btn btn-primary" data-toggle="modal" data-target="#rename-modal-campaign"></button>
                    <!-- Modal dupliquer-->
                    <div id="rename-modal-campaign" class="modal bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <a class="close-modal" data-dismiss="modal" aria-label="Close"></a>
                                </div>
                                <div class="content">
                                    <div><h4>renommer la compaigne</h4></div>
                                    <div class="row btn-new-campaign-folder">
                                        <label for="campaign_new_name">nom de la compaigne </label>
                                        <input id="campaign_new_name" name="campaign_new_name" value="" type="text">
                                        <input name="campaign-id" type="hidden" value="">
                                    </div>                                
                                    <div class="row centered">
                                        <button class="btn-valider btn-rename-campaign">
                                            valider
                                        </button>
                                    </div>
                                    <div class="add-campaign-folder-error"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {#modal delete#}                    
                    <!-- Modal supprimer-->
                    <div id="delete-modal-campaign" class="modal bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <a class="close-modal" data-dismiss="modal" aria-label="Close"></a>
                                </div>
                                <div class="content">
                                    <div><h4>suppression</h4></div>
                                    <div class="row btn-new-campaign-folder">
                                        <label for="">Êtes-vous sûr de vouloir supprimer définitivement cette campagne ?</label>
                                    </div>                                
                                    <div class="row centered">
                                        <button class="btn-valider btn-delete-campaign">
                                            valider
                                        </button>
                                    </div>
                                    <div class="add-campaign-folder-error"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Modal créer nouveau-->                    
                    <div id="new-campaign-modal" class="modal bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                        <div class="modal-dialog modal-lg big" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <a class="previous"></a>
                                    <a class="close-modal" data-target="#abort-new-campaign-modal" data-toggle="modal" aria-label="Close"></a>
                                </div>
                                <div class="content">                                   
                                </div>
                            </div>
                        </div>
                    </div> 
                    <!-- Modal création envoyé-->                    
                    <div id="done-campaign-modal" class="modal bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                        <div class="modal-dialog modal-lg big" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <a class="close-modal" data-dismiss="modal" aria-label="Close"></a>
                                </div>
                                <div class="content"> 
                                    <div><h4>c'est parti !</h4></div>
                                    <div>
                                        <p>
                                            Votre campagne est programmée pour le <span class="date-envoi"></span>.
                                        </p>
                                        <p>
                                            Vous pourrez la retrouver, la modifier ou l'éditer dans la liste des campagnes.
                                        </p>
                                    </div>
                                    <div></div>
                                </div>
                            </div>
                        </div>
                    </div> 
                    <!-- Modal suspendre création nouveau-->                    
                    <div id="abort-new-campaign-modal" class="modal bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                        <div class="modal-dialog modal-lg " role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <a class="close-modal" data-dismiss="modal" aria-label="Close"></a>
                                </div>
                                <div class="content">
                                    <div><h4>Suspendre la création d'une campagne</h4></div>
                                    <div class="row btn-new-campaign-folder">
                                        <label>Vous allez suspendre le processus de création d'une campagne. <br> Celle-ci va s'enregistrer dans la liste de vos campagnes, vous pourrrez ainsi l'éditer ultérieurement</label>
                                    </div>                                
                                    <div class="row centered">
                                        <button class="btn-valider btn-abort-creation" data-dismiss="modal" data-toggle="modal" data-target="#new-campaign-modal">
                                            suspendre
                                        </button>
                                    </div>
                                    <div class="add-campaign-folder-error"></div>
                                </div>
                            </div>
                        </div>
                    </div>             
                </section>
                <input id="new_folder_link" type="hidden" value="{{ path("admin_communication_emailing_compaign_new_folder") }}">
                <input type="hidden" name="replicate" value="{{ path("admin_communication_emailing_compaign_replicate") }}">
                <input type="hidden" name="rename" value="{{ path("admin_communication_emailing_compaign_rename") }}">
                <input type="hidden" name="filtered" value="{{ path("admin_communication_emailing_compaign_filter") }}">
                <input type="hidden" name="delete-campaign-link" value="{{ path("admin_communication_emailing_compaign_delete") }}">
                <input type="hidden" name="add_template_form_url" value="{{ path("admin_communication_emailing_templates_add_template") }}">
                <input type="hidden" name="new_campaign_url" value="{{ path("admin_communication_emailing_compaign_new") }}">
                <input type="hidden" name="ckeditor_config_light_path" value="{{ asset('ckeditor/custom/config-light.js') }}">
                <input type="hidden" name="template_content_type_image" value="{{ constant('IMAGE', content_type_class) }}">
                <input type="hidden" name="template_content_type_text" value="{{ constant('TEXT', content_type_class) }}">
                
            </div>
        </div>

        <div class = "row separator"></div>
    </main>

{% endblock %}

{% block footer %}
    {% embed 'AdminBundle::footer.html.twig' %}
        {% block javascripts %}
            {{ parent() }}
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/3.51/jquery.form.min.js"></script>
            <script src="{{ asset("minicolors/js/jquery.minicolors.js") }}"></script>   
            <script src="{{ asset('ckeditor/ckeditor.js') }}"></script>                     
            <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
            <script src="{{ asset('datepicker/i18n/datepicker-fr.js') }}"></script>
            <script src="{{ asset('js/admin-parameters-contents.js') }}"></script>            
            <script src="{{ asset('chosen/chosen.jquery.js') }}"></script>
            <script src="{{ asset('js/admin-emailing-campaign.js') }}"></script>             
        {% endblock %}
    {% endembed %}
{% endblock %}