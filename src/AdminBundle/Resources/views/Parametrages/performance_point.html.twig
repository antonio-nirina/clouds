{% extends "AdminBundle::layout.html.twig" %}

{% block header %}
    {% embed 'AdminBundle::header.html.twig' %}
        {% block stylesheets %}
            {{ parent() }}
            <link href="{{ asset("css/admin-resultat-form.css") }}" rel="stylesheet">
        {% endblock %}
    {% endembed %}
{% endblock %}

{% block main %}

    {{ render(controller('AdminBundle:Parametrages:sidebar',{'active':4})) }}
    {# {{ include("AdminBundle:Parametrages:menu-sidebar-parametrages.html.twig") }} #}

    <main class="col-md-9  offset-md-1 float-left main">
        <div class = "row">
            <div class = "col-12 col-md-12 sous-menu-main">
                <nav class="navbar navbar-toggleable-md navbar-inverse bg-inverse menu-niv-3">
                    <ul class="content-menu-niv-3 hidden-lg-up">
                        <li class="nav-item-niv-3 form-inscription">
                            <a class="nav-link-niv-3 menu-page-active" href="{{ path("admin_point_performance") }}">performances</a>
                            <span class = "bulle-aide"></span>
                        </li>
                    </ul>
                    <div class="navbar-collapse collapse" id="collapsingNavbarFormInscription">
                        <ul class="navbar-nav content-menu-niv-3">
                            <li class="nav-item-niv-3 form-inscription">
                                <a class="nav-link-niv-3 menu-page" href="{{ path("admin_point_product") }}">produits</a>
                                <span class = "bulle-aide"></span>
                            </li>

                            <li class="nav-item-niv-3 form-imports">
                                <a class="nav-link-niv-3 menu-page" href="{{ path("admin_point_periode") }}">périodes </a>
                                <span class = "bulle-aide"></span>
                            </li>

                            <li class="nav-item-niv-3 form-imports">
                                <a class="nav-link-niv-3 menu-page" href="{{ path("admin_point_rang") }}">rang </a>
                                <span class = "bulle-aide"></span>
                            </li>

                            <li class="nav-item-niv-3 form-imports hidden-md-down">
                                <a class="nav-link-niv-3 menu-page-active" href="{{ path("admin_point_performance") }}">performances</a>
                                <span class = "bulle-aide"></span>
                            </li>
                        </ul>
                    </div>
                    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#collapsingNavbarFormInscription" style = "margin-right: 0;right: 0;color: #505050;border: 1px solid black;">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <a class="navbar-brand abs" href="#"></a>
                </nav>
            </div>
        </div>
        

        <div class = "row">   
            <div class = "col-12 col-md-12 sous-menu-main">
                <section class="fieldset active">
                    <div class = "row full-width no-contents">
                        <div class = "col-md-8 col-lg-9 col-sm-12 content-bloc-droite">
                            <h3 class = "hidden-sm-down">
                                Cette rubrique vous permet de définir les règles d'attribution des points par comparaison aux performances antérieures du participant,
                                ou par comparaison aux performances des autres participants.
                            </h3>
                            <h5 class = "hidden-md-up">
                                Cette rubrique vous permet de définir les règles d'attribution des points par comparaison aux performances antérieures du participant,
                                ou par comparaison aux performances des autres participants.
                            </h5>
                        </div>
                        <div class = "col-md-2 col-lg-1 hidden-sm-down">
                        </div>
                        <div class = "col-md-2 col-lg-2 hidden-sm-down">
                            <div class = " content-bloc-gauche img-point-performances rounded-circle"></div> 
                        </div>
                    </div> 
                    {{ form_start(performance_form1) }}
                        {% for pas in performance_form1.point_attribution_setting %}
                            {% if (loop.first) %} 
                                {% set status = pas.status.vars.value %} 
                                <div class="rank performances">           
                                    <input id="ca-performance" type="checkbox" name="ca-performance" {{ (status == "on")?"checked":"" }}>
                                    <label for="ca-performance">
                                        <span></span>
                                        <div>
                                            <span>attribution des points par tranches de CA</span>
                                        </div>
                                    </label>                            
                                </div>
                                <input type="hidden" name="ca-points" value="1">
                            {% endif %}                        
                            <div class="performance">  
                                <span>{{ pas.vars.value.name }} </span>                          
                                <span><label>de </label>{{ form_widget(pas.min_value) }} &nbsp;%</span>                          
                                <span><label>à</label> {{ form_widget(pas.max_value) }} &nbsp;%</span>                          
                                <span><label>=</label> {{ form_widget(pas.gain) }} 
                                    <span>&euro;</span>
                                </span>
                                {{ form_widget(pas.status) }}
                            </div>
                        {% endfor %}
                        <div class="error-message-container"></div>
                        <div class = "row full-width">
                            <div class = "col-12 col-md-12">
                                <div class="validation">
                                    <button class ="btn-valider valider">
                                        valider
                                    </button>
                                </div>
                            </div>
                        </div>
                    {{ form_end(performance_form1) }}
                    <div class="error-message-container">
                        {% set errorArray = [] %}
                        {% for pas in performance_form1.point_attribution_setting %}
                            {% for child in pas.children %}
                                {% if (form_errors(child) and (form_errors(child) not in errorArray)) %}
                                    {% set errorArray = errorArray|merge([form_errors(child)]) %}
                                {% endif %}
                            {% endfor %}                      
                        {% endfor %}
                        {% for error in errorArray %}
                            {{ error|raw }}
                        {% endfor %}
                    </div>
                    
                    <div class="error-message-container"></div> 
                    <div class="error-message-container"></div> 
                    {{ form_start(performance_form2) }}
                        {% for pas in performance_form2.point_attribution_setting %}
                            {% if (loop.first) %} 
                                {% set status = pas.status.vars.value %}                    
                                <div class="rank performances">           
                                    <input id="classement-performance" type="checkbox" name="classement-performance" {{ (status == "on")?"checked":"" }}>
                                    <label for="classement-performance">
                                        <span></span>
                                        <div>
                                            <span>attribution des points par tranches de CA</span>
                                        </div>
                                    </label>                            
                                </div>
                                <input type="hidden" name="classment-points" value="1">
                            {% endif %}                        
                            <div class="performance">
                                <span>{{ pas.vars.value.name }} </span>
                                <span><label>du</label> {{ form_widget(pas.min_value) }} </span>
                                <span><label>au</label> {{ form_widget(pas.max_value) }} </span>
                                <span>
                                    <label>=</label> 
                                    {{ form_widget(pas.gain) }}
                                    <span>&euro; </span>
                                </span>
                                {{ form_widget(pas.status) }}
                            </div>
                        {% endfor %}
                        <div class="error-message-container"></div>                        
                        <div class = "row full-width">
                            <div class = "col-12 col-md-12">
                                <div class="validation">
                                    <button class ="btn-valider valider">
                                        valider
                                    </button>
                                </div>
                            </div>
                        </div>
                    {{ form_end(performance_form2) }}

                    <div class="error-message-container">
                        {% set errorArray = [] %}
                        {% for pas in performance_form2.point_attribution_setting %}
                            {% for child in pas.children %}
                                {% if (form_errors(child) and (form_errors(child) not in errorArray)) %}
                                    {% set errorArray = errorArray|merge([form_errors(child)]) %}
                                {% endif %}
                            {% endfor %}                      
                        {% endfor %}
                        {% for error in errorArray %}
                            {{ error|raw }}
                        {% endfor %}
                    </div>

                </section>
            </div>
        </div>       
        
        <div class = "row separator"></div>
    </main>

{% endblock %}

{% block footer %}
    {% embed 'AdminBundle::footer.html.twig' %}
        {% block javascripts %}
            {{ parent() }}
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/3.51/jquery.form.min.js"></script> {# utile pour soumettre le forme par ajax #}
            <script src="{{ asset('js/admin-import.js') }}"></script>
        {% endblock %}
    {% endembed %}
{% endblock %}