{% extends "AdminBundle::layout.html.twig" %}

{% block header %}
    {% embed 'AdminBundle::header.html.twig' %}
        {% block stylesheets %}
            {{ parent() }}
            <link href="{{ asset("css/admin-resultat-form.css") }}" rel="stylesheet">
        {% endblock %}
    {% endembed %}
{% endblock %}

{% block main %}

    {{ render(controller('AdminBundle:Parametrages:sidebar',{'active':4})) }}
    {# {{ include("AdminBundle:Parametrages:menu-sidebar-parametrages.html.twig") }} #}

    <main class="col-md-9  offset-md-1 float-left main">
        <div class = "row">
            <div class = "col-12 col-md-12 sous-menu-main">
                <nav class="navbar navbar-toggleable-md navbar-inverse bg-inverse menu-niv-3">
                    <ul class="content-menu-niv-3 hidden-lg-up">
                        <li class="nav-item-niv-3 form-inscription">
                            <a class="nav-link-niv-3 menu-page-active" href="{{ path("admin_point_rang") }}">rang</a>
                            <span class = "bulle-aide" data-trigger-id="trigger-rank"></span>
                        </li>
                    </ul>
                    <div class="navbar-collapse collapse" id="collapsingNavbarFormInscription">
                        <ul class="navbar-nav content-menu-niv-3">
                            <li class="nav-item-niv-3 form-inscription">
                                <a class="nav-link-niv-3 menu-page" href="{{ path("admin_point_product") }}">produits</a>
                                <span class = "bulle-aide" data-trigger-id="trigger-product"></span>
                            </li>

                            <li class="nav-item-niv-3 form-imports">
                                <a class="nav-link-niv-3 menu-page" href="{{ path("admin_point_periode") }}">périodes </a>
                                <span class = "bulle-aide" data-trigger-id="trigger-period"></span>
                            </li>

                            <li class="nav-item-niv-3 form-imports hidden-md-down">
                                <a class="nav-link-niv-3 menu-page-active" href="{{ path("admin_point_rang") }}">rang </a>
                                <span class = "bulle-aide" data-trigger-id="trigger-rank"></span>
                            </li>

                            <li class="nav-item-niv-3 form-imports">
                                <a class="nav-link-niv-3 menu-page" href="{{ path("admin_point_performance") }}">performances </a>
                                <span class = "bulle-aide" data-trigger-id="trigger-performance"></span>
                            </li>
                        </ul>
                    </div>
                    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#collapsingNavbarFormInscription" style = "margin-right: 0;right: 0;color: #505050;border: 1px solid black;">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <a class="navbar-brand abs" href="#"></a>

                    <!-- dialog - bulles d'aide -->
                    <button id="trigger-product" type="button" class="btn btn-primary page-help-dialog-trigger" data-toggle="modal" data-target="#page-help-dialog-product"></button>
                    <div id="page-help-dialog-product" class="modal fade page-help-dialog" tabindex="-1" role="dialog">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-body">
                                    <div class="modal-body-container">
                                        <div class="question-mark"></div>
                                        <div class="text-container">
                                            <h3 class="hidden-sm-down">Cette rubrique vous permet de définir les règles d’attribution des points par comparaison aux performances antérieures du participant, ou par comparaison aux performances des autres participants.</h3>
                                            <h5 class="hidden-md-up">Cette rubrique vous permet de définir les règles d’attribution des points par comparaison aux performances antérieures du participant, ou par comparaison aux performances des autres participants.</h5>
                                            <p>
                                                La rubrique « performances » vous sert à récompenser, ou accorder des bonus, pour les efforts réalisés par vos participants.
                                                Vous pouvez ainsi récompenser la croissance des résultats de chaque participant, d’un mois à l’autre, et/ou son classement par rapport aux autres participants du même rang.
                                                Ces récompenses sont des valeurs fixes, contrairement aux autres critères de récompenses qui sont des pourcentages, et ne sont pas modérées suivant la saisonnalité.
                                            </p>
                                        </div>
                                        <div>
                                            <button class ="btn-valider return" data-dismiss="modal">
                                                retour
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button id="trigger-period" type="button" class="btn btn-primary page-help-dialog-trigger" data-toggle="modal" data-target="#page-help-dialog-period"></button>
                    <div id="page-help-dialog-period" class="modal fade page-help-dialog" tabindex="-1" role="dialog">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-body">
                                    <div class="modal-body-container">
                                        <div class="question-mark"></div>
                                        <div class="text-container">
                                            <h3 class="hidden-sm-down">Cette rubrique vous permet de définir les règles d’attribution et d’utilisation des points, en fonction de la saisonnalité de vos produits ou de votre activité.</h3>
                                            <h5 class="hidden-md-up">Cette rubrique vous permet de définir les règles d’attribution et d’utilisation des points, en fonction de la saisonnalité de vos produits ou de votre activité.</h5>
                                            <p>
                                                EARN : Vous avez la possibilité d’appliquer un facteur modérateur ou multiplicateur pour attribuer vos points en fonction des mois et de vos produits.
                                                Attention, attribuer 100%  revient à attribuer les même nombre que vous avez défini dans la rubrique « produits ».
                                                Attribuer 105% par exemple, revient donc à augmenter de 5% le nombre de points accordés sur le mois désigné.
                                                Un champs non rempli prend par défaut le pourcentage que vous avez attribué dans la rubrique « produits ».
                                                <br><br>
                                                BURN : Pour créer un effet « épargne », vous avez également la possibilité de paramétrer le moment où vos participants pourront dépenser leurs points.
                                                Attention toutefois à ne pas repousser trop loin ce moment, pour ne pas que la frustration remplace la motivation.
                                                Un champs non rempli signifie que vos participants pourront à tout moment consommer leurs points.
                                            </p>
                                        </div>
                                        <div>
                                            <button class ="btn-valider return" data-dismiss="modal">
                                                retour
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button id="trigger-rank" type="button" class="btn btn-primary page-help-dialog-trigger" data-toggle="modal" data-target="#page-help-dialog-rank"></button>
                    <div id="page-help-dialog-rank" class="modal fade page-help-dialog" tabindex="-1" role="dialog">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-body">
                                    <div class="modal-body-container">
                                        <div class="question-mark"></div>
                                        <div class="text-container">
                                            <h3 class="hidden-sm-down">Cette rubrique vous permet de définir les règles d’attribution des points, en fonction du rang commercial de vos participants.</h3>
                                            <h5 class="hidden-md-up">Cette rubrique vous permet de définir les règles d’attribution des points, en fonction du rang commercial de vos participants.</h5>
                                            <p>
                                                Votre chaîne commerciale fait peut-être intervenir un management commercial à plusieurs niveaux ?
                                                Vous avez ainsi la possibilité de récompenser, sur 5 niveaux, les managers de différents niveaux en fonction des résultats consolidés réalisés par les équipes qu’ils managent ou les forces de vente qu’ils adressent.
                                                Par exemple, un directeur d’agence (rang 2) pourra être récompensé pour les résultats de ses agents commerciaux (rang 1), ou un commercial B2B pour les résultats des distributeurs qu’il adresse. Le rang 1 représente le rang qui vous avez déjà défini dans la rubrique « produits ».
                                                Le rang supérieur a le résultat consolidé du rang inférieur.
                                            </p>
                                        </div>
                                        <div>
                                            <button class ="btn-valider return" data-dismiss="modal">
                                                retour
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button id="trigger-performance" type="button" class="btn btn-primary page-help-dialog-trigger" data-toggle="modal" data-target="#page-help-dialog-performance"></button>
                    <div id="page-help-dialog-performance" class="modal fade page-help-dialog" tabindex="-1" role="dialog">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-body">
                                    <div class="modal-body-container">
                                        <div class="question-mark"></div>
                                        <div class="text-container">
                                            <h3 class="hidden-sm-down">Cette rubrique vous permet de définir les règles d’attribution des points par comparaison aux performances antérieures du participant, ou par comparaison aux performances des autres participants.</h3>
                                            <h5 class="hidden-md-up">Cette rubrique vous permet de définir les règles d’attribution des points par comparaison aux performances antérieures du participant, ou par comparaison aux performances des autres participants.</h5>
                                            <p>
                                                La rubrique « performances » vous sert à récompenser, ou accorder des bonus, pour les efforts réalisés par vos participants.
                                                Vous pouvez ainsi récompenser la croissance des résultats de chaque participant, d’un mois à l’autre, et/ou son classement par rapport aux autres participants du même rang.
                                                Ces récompenses sont des valeurs fixes, contrairement aux autres critères de récompenses qui sont des pourcentages, et ne sont pas modérées suivant la saisonnalité.
                                            </p>
                                        </div>
                                        <div>
                                            <button class ="btn-valider return" data-dismiss="modal">
                                                retour
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- FIN dialog - bulle d'aide -->
                </nav>
            </div>
        </div>
        

        <div class = "row">   
            <div class = "col-12 col-md-12 sous-menu-main">
                <section class="fieldset active">
                    <div class = "row full-width no-contents">
                        <div class = "col-md-8 col-lg-9 col-sm-12 content-bloc-droite">
                            <h3 class = "hidden-sm-down">
                                Cette rubrique vous permet de définir les règles d'attribution des points, en fonction du rang commercial de vos participants
                            </h3>
                            <h5 class = "hidden-md-up">
                                Cette rubrique vous permet de définir les règles d'attribution des points, en fonction du rang commercial de vos participants
                            </h5>
                        </div>
                        <div class = "col-md-2 col-lg-1 hidden-sm-down">
                        </div>
                        <div class = "col-md-2 col-lg-2 hidden-sm-down">
                            <div class = " content-bloc-gauche img-point-rang rounded-circle"></div> 
                        </div>
                    </div>
                    <p class="bld color2 left">Choisissez vos rangs, nommez-les et attribuez leur un pourcentage :</p>
                    <div class="row rank_header">
                        <div class="rank">
                        </div>
                        <div class="denomination hidden-sm-down">
                            dénomination
                        </div>
                        <span class="hidden-sm-down"></span>
                        <div class="recompense hidden-sm-down">
                            récompenses
                        </div>
                    </div>

                    {{ form_start(roles_form) }}
                        {% for role in roles_form.roles %}
                            {% set current = role.vars.value.rank %}
                            {% set current1 = role.vars.id %}
                            <div class="row">
                                <div class="rank">           
                                    {{ form_widget(role.active) }}
                                    <label for="{{current1}}_active">
                                        <span></span>
                                        <div>
                                            <span>rang {{ current }}</span>
                                        </div>
                                    </label>                            
                                </div>
                                <div class="denomination">
                                    <span class="label-text hidden-md-up">dénomination</span>
                                    {{ form_widget(role.name) }}
                                </div>
                                <span class="hidden-sm-down">=</span>
                                <div class="recompense">
                                    <span class="label-text hidden-md-up">récompense</span>
                                    {{ form_widget(role.gain) }}                                 
                                </div>
                                <span>%</span>                                
                            </div>
                            
                        {% endfor %}
                        <div class="error-message-container"></div>
                        <div class = "row full-width">
                            <div class = "col-12 col-md-12">
                                <div class="validation">
                                    <button class ="btn-valider valider">
                                        valider
                                    </button>
                                </div>
                            </div>
                        </div>
                    {{ form_end(roles_form) }}

                    
                    <div class="error-message-container">
                        {% set errorArray = [] %}
                        {% for role in roles_form.roles %}
                            {% if (form_errors(role.gain) and (form_errors(role.gain) not in errorArray)) %}
                                {% set errorArray = errorArray|merge([form_errors(role.gain)]) %}
                            {% endif %}                            
                        {% endfor %}
                        {% for error in errorArray %}
                            {{ error|html }}
                        {% endfor %}
                    </div>

                </section>
            </div>
        </div>       
        
        <div class = "row separator"></div>
    </main>

{% endblock %}

{% block footer %}
    {% embed 'AdminBundle::footer.html.twig' %}
        {% block javascripts %}
            {{ parent() }}
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/3.51/jquery.form.min.js"></script> {# utile pour soumettre le forme par ajax #}
            <script src="{{ asset('js/admin-import.js') }}"></script>
        {% endblock %}
    {% endembed %}
{% endblock %}